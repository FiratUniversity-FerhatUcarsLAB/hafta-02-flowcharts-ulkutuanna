digraph ATM_Sistemi {
    node [fontname="Arial"];
    
    start [shape=oval, label="BAŞLA"];
    pin_input [shape=parallelogram, label="OKU PIN"];
    check_pin [shape=diamond, label="PIN doğru mu?"];
    wrong_pin [shape=box, label="PIN_HAKKINI_AZALT"];
    pin_retry [shape=diamond, label="PIN_HAKKI > 0 ?"];
    block_card [shape=box, label="Kartı Bloke Et"];
    
    amount_input [shape=parallelogram, label="OKU TUTAR"];
    check_mod [shape=diamond, label="TUTAR % 20 == 0?"];
    mod_error [shape=parallelogram, label="YAZ: 20 TL'nin katı olmalı"];
    
    check_balance [shape=diamond, label="BAKİYE yeterli mi?"];
    balance_error [shape=parallelogram, label="YAZ: Yetersiz bakiye"];
    
    check_limit [shape=diamond, label="Limit yeterli mi?"];
    limit_error [shape=parallelogram, label="YAZ: Günlük limit aşıldı"];
    
    update_balance [shape=box, label="BAKIYEYI_GUNCELLE"];
    success_msg [shape=parallelogram, label="YAZ: İşlem başarılı"];
    
    repeat_prompt [shape=parallelogram, label="OKU: Başka işlem? (E/H)"];
    repeat_check [shape=diamond, label="CEVAP 'E' mi?"];
    
    end [shape=oval, label="BİTİR"];

    // Akış bağlantıları
    start -> pin_input;
    pin_input -> check_pin;
    
    // PIN Doğrulama Akışı
    check_pin -> amount_input [label="Evet"];
    check_pin -> wrong_pin [label="Hayır"];
    wrong_pin -> pin_retry;
    pin_retry -> pin_input [label="Evet"];
    pin_retry -> block_card [label="Hayır"];
    block_card -> end;

    // Ana Para Çekme Akışı
    amount_input -> check_mod;
    check_mod -> check_balance [label="Evet"];
    check_mod -> mod_error [label="Hayır"];
    mod_error -> amount_input;
    
    check_balance -> check_limit [label="Evet"];
    check_balance -> balance_error [label="Hayır"];
    balance_error -> amount_input;
    
    check_limit -> update_balance [label="Evet"];
    check_limit -> limit_error [label="Hayır"];
    limit_error -> amount_input;
    
    update_balance -> success_msg;
    success_msg -> repeat_prompt;
    repeat_prompt -> repeat_check;
    
    // İşlem Tekrarı Akışı
    repeat_check -> amount_input [label="Evet"];
    repeat_check -> end [label="Hayır"];
}
